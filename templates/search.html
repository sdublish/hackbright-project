{% extends 'base.html' %}
{% block title %} Search {% endblock %}
{% block content %}
<h1 class='text-center'> Search </h1>
<!-- Thing which would be cool to do: have people tell me if they're searching by author or series 
    and modify the form to show the proper fields depending on user input -->
<!-- Use the buttons or something, things which only allow one option -->
<div class="row">
    <div class="col-md-6">
<form id="search" class="form-group">
    <label for="author">Author</label>
    <input class="form-control" type="text" id="author"><br>
    <label for="series">Series</label>
    <select class="form-control" id="series"> 
    <option selected value> -- select an option -- </option>{% for s in series %}
    <option value="{{s.series_name}}"> {{ s.series_name }} </option>
    {% endfor %}
</select><br>
    Publishing Date Timeframe: 
{% for tf, name in tfs.items()|sort %}
{% if tf == 0 %}
    <div class="form-check">
    <input class="form-check-input" type="radio" name="timeframe" checked id="{{ tf }}" value="{{ tf }}">
    <label class="form-check-label" for="{{ tf }}"> {{ name }} </label>
</div>
{% else %}
<div class="form-check">
    <input class="form-check-input" type="radio" name="timeframe" id="{{ tf }}" value="{{ tf }}">
    <label class="form-check-label" for="{{ tf }}"> {{ name }} </label>
</div>
{% endif %}
{% endfor %}
    <button type="submit" class="btn">Submit</button>
</form>
</div>
<div class="col-md-6">
    <h2 class="text-center"> Results </h2>
<p id="results" class="text-center"> No results yet!</p>
<div class="row justify-content-center">

<div class="col-lg-6 mx-auto" id="most-recent">
</div>

<div class="col-lg-6 mx-auto" id="act-results">
</div>

</div>
<!-- How to handle non-users sending email? If I want to> -->
{% if "user_id" in session %}
<button id="results-email" class="btn"> Send Results To Email </button>
{% endif %}
</div>
</div>
{% endblock %}


{% block script %}
<script>
$("#results-email").on("click", function(){
    // get results 
    // send results to specified server route
    $.post("/send-email-results", function(){
        //pop alert saying email was sent
        //as well as email address being used
    });

});

$("#search").on("submit", function(evt){
    evt.preventDefault();
    let author = $("#author").val();
    let series = $("#series").val();

    if (author && series) {
        $("#results").text("Please enter only an author or a series, not both.");
    } else if (!author && !series) {
        $("#results").text("Please enter a value to submit!");
    } else{
        $("#results").text("Searching for info...");
        let date = new Date();
        date = date.toDateString();
        let td = $("input[name=timeframe]:checked").val();
        let formInputs = {"date": date, "author": author, "series": series, "timeframe" : td};
        $.post("/search.json", formInputs, function(result){
            let mrPhrase = `Most recently released: ${result.most_recent[0]}, publication date: ${result.most_recent[1]}`;
            let rPhrase;
            if (result.results[0] === null) {
            rPhrase = "No books found in timeframe.";
            } else {
            rPhrase = `Results: ${result.results[0]}, publication date: ${result.results[1]}.`;
            }

            $("#most-recent").html("<h4>Most Recent</h4><img height='200' src='" + result.most_recent[2] + "'> <p>" + mrPhrase + "</p>" )
            $("#act-results").html("<h4> Result in Timeframe </h4><img height='200' src='" + result.results[2] + "'> <p>" + rPhrase + "</p>" )

            $("#results").text("");

        });
    }

});

</script>
{% endblock %}