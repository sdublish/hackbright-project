{% extends 'base.html' %}
{% block title %} {{ title }} {% endblock %}
{% block content %}
{% if series|length > 0 %}

<h2 class='text-center'> {{ title }} </h2>
<div class="row justify-content-center">
<form id="series-search">
{% for id, name in series.items() %}
<div class="form-check">
<input class="form-check-input" type="radio" value= "{{ id }}" name="series" id="{{ id }}"> 
<label class="form-check-label" for="{{ id }}"> {{ name }} </label>
</div>
{% endfor %}
<br>     Publishing Date Timeframe: 
{% for tf, name in tfs.items()|sort %}
{% if tf == 0 %}
    <div class="form-check">
    <input class="form-check-input" type="radio" name="timeframe" checked id="{{ tf }}" value="{{ tf }}">
    <label class="form-check-label" for="{{ tf }}"> {{ name }} </label>
</div>
{% else %}
<div class="form-check">
    <input class="form-check-input" type="radio" name="timeframe" id="{{ tf }}" value="{{ tf }}">
    <label class="form-check-label" for="{{ tf }}"> {{ name }} </label>
</div>
{% endif %}
{% endfor %}
<button type="submit" class="btn"> Look Up Series! </button>
</form>
</div>
<br>
<div class="row justify-content-center">
<p> None of these are right? Click <a href="/adv-search">here</a> to go back to the advanced search form. </p>
</div>

<div class="row justify-content-center" id="results-headline" style="display:none">
    <h2 class="text-center"> Results </h2>
</div>
<div class="row justify-content-center">

<div class="col-lg-6 text-center" id="most-recent">
</div>

<div class="col-lg-6 text-center" id="act-results">
</div>
{% if "user_id" in session %}
<br> <br>
<button id="results-email" class="btn" style="display:none"> Send Results To Email </button>
{% endif %}

</div>
{% else %}
<div class="row justify-content-center">
<p> No series were found. Please click <a href="/adv-search">here</a> to return back to advanced search </p>
</div>
{% endif %}
{% endblock %}
{% block script %}
 <script>
function showResults(result){
    let mrPhrase = `Most recently released: ${result.most_recent[0]}, publication date: ${result.most_recent[1]}`;
    let rPhrase;
    if (result.results[0] === null) {
    rPhrase = "No books found in timeframe.";
    } else {
    rPhrase = `Results: ${result.results[0]}, publication date: ${result.results[1]}.`;
    }

    $("#most-recent").html("<h4>Most Recent</h4><img height='200' src='" + result.most_recent[2] + "'> <p>" + mrPhrase + "</p>" );
    $("#act-results").html("<h4> Result in Timeframe </h4><img height='200' src='" + result.results[2] + "'> <p>" + rPhrase + "</p>" );
    $("#results-email").show();

}

function searchSeries(evt){
    evt.preventDefault();
    let date = new Date();
    date = date.toDateString();
    let td = $("input[name=timeframe]:checked").val();
    let seriesID = $('input[name=series]:checked').val();
    let IDAsString = `label[for=${seriesID}]`;
    let seriesName = $(IDAsString).text();
    let formInputs = {'id': seriesID, 'name': seriesName, 'date': date, 'timeframe': td};
    $("#results-headline").show();
    $.post("/series-result.json", formInputs, showResults);
}



$("#series-search").on("submit", searchSeries);

$("#results-email").on("click", function(){
    let seriesID = $('input[name=series]:checked').val();
    let IDAsString = `label[for=${seriesID}]`;
    let seriesName = $(IDAsString).text();
    let title = "Bibliofind Search Results for " + seriesName;
    let formInputs = {"result": $("#act-results").html(), "title": title};
    $.post("/email-info.json", formInputs, function(results){
        alert(results["status"]);
    });

});
 </script>
 {% endblock %}